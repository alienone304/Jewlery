
sudo apt-get install -y software-properties-common
sudo apt-get install python-software-properties -y
# ubunto 18: not
sudo add-apt-repository ppa:ondrej/php
sudo apt-get update && sudo apt-get install php7.3 php7.3-fpm php7.3-mysql php-imagick mysql-server && sudo apt-get update
sudo add-apt-repository --remove ppa:ondrej/php
sudo nano /etc/php/7.3/fpm/pool.d/www.conf
############# Then make these changes there: #### ctrl+w can be used for searching #######

listen = /run/php/php7.3-fpm.sock ==> ;listen = /run/php/php7.3-fpm.sock
;##ADD THIS ==>
listen = 127.0.0.1:9000

##############################################################################

wget http://wordpress.org/latest.tar.gz && tar xzf latest.tar.gz && sudo mv wordpress /var/www/tala-market.com
#### or
sudo git clone https://github.com/alienone306/wp.git /var/www/tala-market.com

sudo chmod -R 755 /var/www/tala-market.com && sudo chown www-data:www-data /var/www/tala-market.com/ -R

# on ubuntu 18: run mysql with sudo
mysql -u root -p
create database wordpress;
create user amirfarsad@localhost;
set password for amirfarsad@localhost= password("199271Raiden");
grant all privileges on wordpress.* to amirfarsad@localhost identified by '199271Raiden';
flush privileges;
exit;

#### if not cloned from git run these codes
cd /var/www/tala-market.com && sudo cp wp-config-sample.php wp-config.php && sudo nano wp-config.php

#### CHANGE THESE LINES:

define('FS_METHOD', 'direct');

/** The name of the database for WordPress */
define('DB_NAME', 'wordpress');

/** MySQL database username */
define('DB_USER', 'amirfarsad');

/** MySQL database password */
define('DB_PASSWORD', '199271Raiden');
########################

___________ or as an alternate if using mysql backup and wp backup

git clone https://github.com/alienone306/backup.git backup
mysql -u root -p < backup/all_databases.sql

######### adding https over server
cd JewleryStore
git clone https://github.com/letsencrypt/letsencrypt
cd letsencrypt
./letsencrypt-auto --help
sudo service nginx stop
./letsencrypt-auto certonly --standalone -d tala-market.com
sudo nano /etc/nginx/sites-available/JewleryStore.conf


############################################

upstream JewleryStore_server {
  server unix:/home/amirfarsad/django_env/run/gunicorn.sock fail_timeout=0;
}

server {
    listen 443 ssl;
    server_name tala-market.com www.tala-market.com;
    ssl_certificate /etc/letsencrypt/live/tala-market.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/tala-market.com/privkey.pem;

    client_max_body_size 2M;
    access_log /home/amirfarsad/logs/nginx-access.log;
    error_log /home/amirfarsad/logs/nginx-error.log;

    location /static/ {
        alias   /home/amirfarsad/JewleryStore/static/;
    }

    location /media/ {
        alias   /home/amirfarsad/JewleryStore/media/;
    }

    location / {
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        if (!-f $request_filename) {
            proxy_pass http://JewleryStore_server;
            break;
        }
    }
    error_page 500 502 503 504 /custom_50x.html;
    location = /custom_50x.html {
        root /home/amirfarsad/JewleryStore/templates/nginx_error_pages/;
        internal;
        }

    error_page 404 /custom_404.html;
    location = /custom_404.html {
        root /home/amirfarsad/JewleryStore/templates/nginx_error_pages/;
        internal;
        }

    location /blog {
       alias /var/www/tala-market.com;
       try_files $uri @blog;

       location ~ \.php$ {
         try_files $uri =404;
         fastcgi_pass 127.0.0.1:9000;
         fastcgi_index index.php;
         fastcgi_param SCRIPT_FILENAME $request_filename;
         include fastcgi_params;
       }
    }
    location @blog {
      rewrite /blog/(.*)$ /blog/index.php?/$1 last;
    }

}

server {
	listen 80;
	server_name tala-market.com www.tala-market.com;
	return 301 https://$host$request_uri;
}
